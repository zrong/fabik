# 输出文件参数重构规范

仔细阅读 @./specs/MODULE_FUNCTIONALITY.md 文件，对项目进行如下修改。

## 概述
本文档描述了对 `conf gen` 和 `conf tpl` 命令输出参数的重构方案。主要目标是提供更灵活的输出文件指定方式，支持目录输出和明确文件输出两种模式。

## 参数变更

### 原有参数修改
- **参数名变更**: `--output` → `--output-dir`
- **功能保持**: `--output-dir` 的作用与原 `--output` 参数功能完全一致
- **向后兼容**: 考虑保留 `--output` 作为 `--output-dir` 的别名，确保向后兼容性

### 新增参数
- **参数名**: `--output-file`
- **类型**: 路径字符串
- **功能**: 指定明确的输出文件名称
- **路径支持**: 
  - 绝对路径：直接使用指定的完整路径
  - 相对路径：相对于当前工作目录或配置的基准目录

## 参数优先级规则

### 优先级顺序
1. **`--output-file`** (最高优先级)
2. **`--output-dir`** (次级优先级)
3. **默认输出规则** (最低优先级)

### 处理逻辑
```
if --output-file 提供:
    使用 --output-file 指定的文件路径
    忽略 --output-dir 参数
elif --output-dir 提供:
    使用原有的目录输出逻辑
else:
    使用默认输出规则
```

## 路径处理规则

### `--output-file` 路径处理
1. **绝对路径处理**:
   - 直接使用提供的完整路径
   - 确保父目录存在，不存在则抛出错误（与 `--output-dir`  保持完全一致）
   
2. **相对路径处理**:
   - 上级目录的处理逻辑与 `--output-dir` 保持完全一致
   - 最终文件名使用用户指定的名称

### 路径解析示例
```
# 绝对路径
--output-file /tmp/config/my-config.yaml
→ 输出到: /tmp/config/my-config.yaml

# 相对路径
--output-file configs/app.yaml
→ 上级目录处理: configs/ (按 --output-dir 逻辑)
→ 最终输出: <resolved-configs-path>/app.yaml

# 仅文件名
--output-file app.yaml
→ 上级目录处理: ./ (当前目录，按 --output-dir 逻辑)
→ 最终输出: <resolved-current-path>/app.yaml
```

## 错误处理

### 文件路径验证
- 验证父目录是否可写
- 验证文件名是否合法
- 处理文件已存在的情况（覆盖警告或确认）

### 冲突处理
- 当同时提供 `--output-file` 和 `--output-dir` 时，显示警告信息
- 明确说明 `--output-dir` 将被忽略

## 实现要点

### 命令行接口修改
1. 在 typer 命令定义中添加新的 `--output-file` 参数
2. 将现有 `--output` 参数重命名为 `--output-dir`
3. 可选：保留 `--output` 作为 `--output-dir` 的别名

### 内部逻辑调整
1. 修改输出路径解析函数，支持优先级处理
2. 抽取公共的路径处理逻辑，避免代码重复
3. 更新相关的文档和帮助信息

### 测试覆盖
- 单独使用 `--output-dir` 的场景
- 单独使用 `--output-file` 的场景
- 同时提供两个参数的优先级场景
- 各种路径类型（绝对、相对、仅文件名）的处理
- 错误处理场景（无权限、路径不存在等）

## 向后兼容性

### 兼容性策略
- 保留 `--output` 参数作为 `--output-dir` 的别名
- 在使用 `--output` 时显示弃用警告，建议使用 `--output-dir`
- 提供迁移指南，帮助用户更新脚本和文档

### 弃用时间线
1. **第一阶段**: 添加新参数，保留旧参数，显示警告
2. **第二阶段**: 继续支持旧参数，但在文档中标记为弃用
3. **第三阶段**: 移除旧参数支持（主版本更新时）
